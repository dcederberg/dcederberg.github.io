<!DOCTYPE html>
<html>
<head>
  <title>Pressure Monitor</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container mt-4">
    <h1>Pressure Monitor</h1>
    <canvas id="pressureChart" width="400" height="200"></canvas>
    <button class="btn btn-primary mt-3" onclick="saveData()">Save Data</button>
  </div>

  <script>
    let savedData = [];
    let chartData = [];
    let ws;
    const maxDataPoints = 100;

    // Initialize Chart.js
    const ctx = document.getElementById('pressureChart').getContext('2d');
    const pressureChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: Array.from({length: maxDataPoints}, (_, i) => i),
        datasets: [{
          label: 'Pressure (psi)',
          data: chartData,
          borderColor: 'rgba(75, 192, 192, 1)',
          fill: false,
        }]
      }
    });

    function initWebSocket() {
      ws = new WebSocket('ws://your_arduino_ip:81');
      
      ws.onmessage = function(event) {
        const pressure = parseFloat(event.data).toFixed(2);
        chartData.push(pressure);
        
        // Limit data points, remove oldest if exceeding max
        if (chartData.length > maxDataPoints) {
          chartData.shift();
        }
        
        pressureChart.update();
      };
      
      ws.onclose = function() {
        setTimeout(initWebSocket, 5000);  // Try to reconnect every 5s
      };
    }

    function saveData() {
      const timestamp = new Date().toISOString();
      const blob = new Blob([JSON.stringify({timestamp, data: chartData}, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'pressure_data.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    initWebSocket();
  </script>
</body>
</html>
